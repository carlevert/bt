<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Poem</title>
    <script src="lib/MooTools-Core-1.6.0.js"></script>
    <script>
        var count = 10;

        function do_delete() {
            var req = new Request({
                url: '/experiments',
                onSuccess: function (responseText) {
                    console.log("DELETE successful")
                },
                emulation: false
            });

            if (confirm("Delete everything?"))
                req.delete();

        }

        function do_post() {
            var posts = [];
            var num_posts = $('num_posts').get('value');

            for (i = 0; i < num_posts; i++) {
                var x = parseInt(i);
                var req = new Request({
                    url: '/experiment',
                    onSuccess: function (responseText) {
                        console.log(responseText + x);
                    },
                    onFailure: function (xhr) {
                        console.log(xhr);
                    },
                    async: true
                });
                posts.push(req);
            }

            for (i = 0; i <num_posts; i++) {
                console.log(i);
                posts[i].send();
            }

        }


        // do stuff when the document has loaded but images have not
        window.addEvent('domready', function () {
            $('do_post_button').addEvent('click', do_post);
            $('do_delete_button').addEvent('click', do_delete);

            // setInterval(function() { if (count-- > 0) do_post(); }, 1000);

        });
    </script>
</head>
<body>


<form>
    <input type="text" id="num_posts" value="1" />
    <input type="button" name="do_post_button" id="do_post_button" value="Post" />
    <a href="/experiments">Show all experiments</a>
    <input type="button" name="do_delete_button" id="do_delete_button"  value="Delete everything"/>
    <div id="response"></div>
    <div id="num_requests"></div>
</form>

</body>
</html>